[textdomain]
    name="wesnoth-Era_of_High_Sorcery"
    path="data/add-ons/Era_of_High_Sorcery/translations"
[/textdomain]
#textdomain wesnoth-Era_of_High_Sorcery

#ifdef MULTIPLAYER

#define EOHS_VERSION_STRING
"2.2.0.2"#enddef

# TODO: un-duplicate with website
#define EOHS_DESCRIPTION
_"Era of High Sorcery (EoHS) is an era where your leader is a powerful wizard whose spells can alter the nature of the entire battlefield (sometimes literally!). EoHS features:
- Three realms of magic, each with more than a dozen unique spells
- Pick your recruits from one or more factions
- Ability to customize your wizard's appearance, changing their hairstyle and recoloring their robes and equipment – plus several hats you can earn by performing in-game feats
- No download required for non-host players – anyone can join or observe an EoHS game
- Freely available on the add-on servers for Wesnoth 1.10 and 1.11"#enddef

#define EOHS_LUA_FILE CODE

  [lua]
    code={CODE}
  [/lua]
#enddef

#define EOHS_GIVE_TAG_MACRO_TO_LUA MACRO
[set_variables]
  name=EoHS.GIVE_TAG_MACRO_TO_LUA
  mode=replace
  [literal]
    {{MACRO}}
  [/literal]
[/set_variables]
[lua]
  code="EoHS.macros.{MACRO} = wesnoth.get_variable(""EoHS.GIVE_TAG_MACRO_TO_LUA"")"
[/lua]
#enddef

#define EOHS_GIVE_VALUE_MACRO_TO_LUA MACRO
[set_variable]
  name=EoHS.GIVE_VALUE_MACRO_TO_LUA
  literal={{MACRO}}
[/set_variable]
[lua]
  code="EoHS.macros.{MACRO} = wesnoth.get_variable(""EoHS.GIVE_VALUE_MACRO_TO_LUA"")"
[/lua]
#enddef
  
#define EOHS_EVENTS BEFORE_PRELOAD_CODE INIT_CODE
  [event]
    name=prestart
    [if]
      [variable]
        name="EoHS_prestart_occurred"
        boolean_equals="true"
      [/variable]
      [then]
        [lua]
          code=<<EoHS.message("This game was hosted with two instances of EoHS at the same time. The second one is being ignored.")>>
        [/lua]
      [/then]
      [else]
        [set_variable]
          name="EoHS_prestart_occurred"
          value="true"
        [/set_variable]
        [set_variables]
          name=EoHS.wesnoth_cfgs.terrain
          mode=replace
          [literal]
            {core/terrain.cfg}
          [/literal]
        [/set_variables]
        [set_variables]
          name=EoHS.wesnoth_cfgs.team_colors
          mode=replace
          [literal]
            {core/team-colors.cfg}
          [/literal]
        [/set_variables]
        [set_variables]
          name=EoHS.preload
          [literal]
            [lua]
              code=<<--EOHS_ERA_SHARED
    EoHS = {
      helper = wesnoth.require("lua/helper.lua"),
      _ = wesnoth.textdomain("wesnoth-Era_of_High_Sorcery"),
      macros = {},
      context = {unison=false, synchronized=false, in_event=false} -- The appropriate context for the preload stuff
    }
    >>
            [/lua]
            [lua]
              code={BEFORE_PRELOAD_CODE}
            [/lua]
            
            {EOHS_GIVE_TAG_MACRO_TO_LUA ABILITY_HEALS}
            {EOHS_GIVE_TAG_MACRO_TO_LUA ABILITY_CURES}
            {EOHS_GIVE_TAG_MACRO_TO_LUA ABILITY_REGENERATES}
            {EOHS_GIVE_TAG_MACRO_TO_LUA ABILITY_SKIRMISHER}
            {EOHS_GIVE_TAG_MACRO_TO_LUA ABILITY_SUBMERGE}
            {EOHS_GIVE_TAG_MACRO_TO_LUA ABILITY_ILLUMINATES}
            {EOHS_GIVE_TAG_MACRO_TO_LUA ABILITY_TELEPORT}
            {EOHS_GIVE_TAG_MACRO_TO_LUA ABILITY_LEADERSHIP_LEVEL_1}
            {EOHS_GIVE_TAG_MACRO_TO_LUA WEAPON_SPECIAL_SLOW}
            {EOHS_GIVE_TAG_MACRO_TO_LUA WEAPON_SPECIAL_DRAIN}
            {EOHS_GIVE_TAG_MACRO_TO_LUA WEAPON_SPECIAL_PLAGUE}
            {EOHS_GIVE_TAG_MACRO_TO_LUA WEAPON_SPECIAL_POISON}
            {EOHS_GIVE_TAG_MACRO_TO_LUA WEAPON_SPECIAL_CHARGE}
            {EOHS_GIVE_TAG_MACRO_TO_LUA WEAPON_SPECIAL_MAGICAL}
            {EOHS_GIVE_TAG_MACRO_TO_LUA WEAPON_SPECIAL_MARKSMAN}
            {EOHS_GIVE_TAG_MACRO_TO_LUA WEAPON_SPECIAL_FIRSTSTRIKE}
            {EOHS_GIVE_TAG_MACRO_TO_LUA TRAIT_STRONG}
            {EOHS_GIVE_TAG_MACRO_TO_LUA TRAIT_QUICK}
            {EOHS_GIVE_TAG_MACRO_TO_LUA TRAIT_INTELLIGENT}
            {EOHS_GIVE_TAG_MACRO_TO_LUA TRAIT_RESILIENT}
            {EOHS_GIVE_TAG_MACRO_TO_LUA TRAIT_DEXTROUS}
            {EOHS_GIVE_TAG_MACRO_TO_LUA TRAIT_HEALTHY}
            {EOHS_GIVE_TAG_MACRO_TO_LUA TRAIT_FEARLESS}
            {EOHS_GIVE_TAG_MACRO_TO_LUA TRAIT_WEAK}
            {EOHS_GIVE_TAG_MACRO_TO_LUA TRAIT_DIM}
            {EOHS_GIVE_TAG_MACRO_TO_LUA TRAIT_SLOW}
            {EOHS_GIVE_TAG_MACRO_TO_LUA TRAIT_UNDEAD}
            {EOHS_GIVE_TAG_MACRO_TO_LUA TRAIT_MECHANICAL}
            {EOHS_GIVE_TAG_MACRO_TO_LUA TRAIT_LOYAL}
            {EOHS_GIVE_VALUE_MACRO_TO_LUA EOHS_VERSION_STRING}
            {EOHS_GIVE_VALUE_MACRO_TO_LUA EOHS_DESCRIPTION}
            
            {gui/default/macros/_initial.cfg}
            {EOHS_GIVE_TAG_MACRO_TO_LUA GUI__LISTBOX_SELECTED_CELL}
            {EOHS_GIVE_VALUE_MACRO_TO_LUA GUI__BACKGROUND_COLOR_ENABLED}
            {EOHS_GIVE_VALUE_MACRO_TO_LUA GUI__TEXT_VERTICALLY_CENTRED}
            {EOHS_GIVE_VALUE_MACRO_TO_LUA GUI__TEXT_HORIZONTALLY_CENTRED}
            {EOHS_GIVE_VALUE_MACRO_TO_LUA GUI__FONT_COLOR_ENABLED__DEFAULT}
            {EOHS_GIVE_VALUE_MACRO_TO_LUA GUI__FONT_COLOR_ENABLED__TITLE}
            {EOHS_GIVE_VALUE_MACRO_TO_LUA GUI__FONT_COLOR_DISABLED__TITLE}
            {EOHS_GIVE_VALUE_MACRO_TO_LUA GUI_NORMAL__FONT_SIZE__LARGE}
            {EOHS_GIVE_VALUE_MACRO_TO_LUA GUI_NORMAL__FONT_SIZE__SMALL}
            
            {CLEAR_VARIABLE EoHS.GIVE_TAG_MACRO_TO_LUA}
            {CLEAR_VARIABLE EoHS.GIVE_VALUE_MACRO_TO_LUA}
            
            {~add-ons/Era_of_High_Sorcery/lua_files/}
            {~add-ons/Era_of_High_Sorcery/lua_files/actions/}
            [lua]
              code="for i,func in ipairs(EoHS.end_of_preload_funcs) do func() end; EoHS.context = nil"
            [/lua]
          [/literal]
        [/set_variables]
        [insert_tag]
          name=command
          variable=EoHS.preload
        [/insert_tag]
        [lua]
          code={INIT_CODE}
        [/lua]
      [/else]
    [/if]
  [/event]
#enddef

#define EOHS_ERA_SHARED TYPE_NAME INIT_CODE
  require_era=no
  
  [multiplayer_side]
    id=EoHS_Faction
    name="&icons/scroll_red.png="+_"Wizards (v"+{EOHS_VERSION_STRING}+", "+{TYPE_NAME}+")"
    type="Red Mage"
    leader="Red Mage"
  [/multiplayer_side]
  
  {EOHS_EVENTS ("") ({INIT_CODE})}
#enddef

[era]
  id="EoHS: Era of High Sorcery"
  name= _ "EoHS: Era of High Sorcery"
  description={EOHS_DESCRIPTION}
  # TODO: description=, for 1.11
  {EOHS_ERA_SHARED (_"Default") (<<EoHS.init_campaign()>>)}
[/era]

[era]
  id="EoHS: Alternative settings"
  name= _ "EoHS: Alternative settings"
  description={EOHS_DESCRIPTION}
  {EOHS_ERA_SHARED (_"Alt settings") (<<EoHS.init_campaign({ first_player_picks_settings=true })>>)}
[/era]

#ifver WESNOTH_VERSION >= 1.11.10
[modification]
  id="EoHS with any era"
  name= _ "EoHS with any era"
  description=_"In this version of EoHS, the alliances are replaced with the factions from whatever era you choose.
 
"+{EOHS_DESCRIPTION}
  {EOHS_EVENTS (<<EoHS.replace_alliances_with_era=true>>) (<<EoHS.init_campaign()>>)}
[/modification]

[modification]
  id="EoHS with any era: Alternative settings"
  name= _ "EoHS with any era: Alternative settings"
  description=_"In this version of EoHS, the alliances are replaced with the factions from whatever era you choose.
 
"+{EOHS_DESCRIPTION}
  {EOHS_EVENTS (<<EoHS.replace_alliances_with_era=true>>) (<<EoHS.init_campaign({ first_player_picks_settings=true })>>)}
[/modification]
#endif

{~add-ons/Era_of_High_Sorcery/scenarios/}

[+units]
  [unit_type]
    id="EoHS_local_version_checker"
    name={EOHS_VERSION_STRING}
    hide_help="true"
    do_not_list="true"
    alignment="neutral"
  [/unit_type]
[/units]

#ifhave ~add-ons/War_Of_The_Gods/_main.cfg
        #{~add-ons/War_Of_The_Gods/scenarios}
        {~add-ons/War_Of_The_Gods/macros}
        #{~add-ons/War_Of_The_Gods/images}
        #{~add-ons/War_Of_The_Gods/sounds}
        {~add-ons/War_Of_The_Gods/utils}
        #textdomain wesnoth-War_Of_The_Gods
#Faction

[era]
    id=EoHS: Alternative settings plus War_Of_The_Gods_Era_Random_Recruits
    name= _ "@EoHS: Alternative Settings / War Of The Gods Era Random Recruits v2.5"
    require_era=no #yes
        
    {RANDOM_SIDE}
    {~add-ons/War_Of_The_Gods/factions/Sower_Of_Light_Random_Recruits-War_Of_The_Gods.cfg}
    {~add-ons/War_Of_The_Gods/factions/Sower_Of_Peace_Random_Recruits-War_Of_The_Gods.cfg}
    {~add-ons/War_Of_The_Gods/factions/Sower_Of_Chaos_Random_Recruits-War_Of_The_Gods.cfg}
    {~add-ons/War_Of_The_Gods/factions/Sower_Of_Death_Random_Recruits-War_Of_The_Gods.cfg}
    {~add-ons/War_Of_The_Gods/factions/Sower_Of_Greed_Random_Recruits-War_Of_The_Gods.cfg}
    {~add-ons/War_Of_The_Gods/factions/Sower_Of_Ancients_Knowledge_Random_Recruits-War_Of_The_Gods.cfg}
        
        
        [event]
        name=prestart
                {MODIFICATIONS_START}
        [/event]
        
        [event]
                name=turn 1
                first_time_only=yes
                [set_variable]
                        name=RED
                        rand=1..255
                [/set_variable]
                [set_variable]
                        name=GREEN
                        rand=1..255
                [/set_variable]
                [set_variable]
                        name=BLUE
                        rand=1..255
                [/set_variable]
                {ALL_UNITS_2LVLS_SOWER_OF_ANCIENTS_KNOWLEDGE}
                {ALL_UNITS_2LVLS_SOWER_OF_GREED}
                {ALL_UNITS_2LVLS_SOWER_OF_DEATH}
                {ALL_UNITS_2LVLS_SOWER_OF_LIGHT}
                {ALL_UNITS_2LVLS_SOWER_OF_CHAOS}
                {ALL_UNITS_2LVLS_SOWER_OF_PEACE}
                {ALL_UNITS_3LVLS_SOWER_OF_ANCIENTS_KNOWLEDGE}
                {ALL_UNITS_3LVLS_SOWER_OF_GREED}
                {ALL_UNITS_3LVLS_SOWER_OF_DEATH}
                {ALL_UNITS_3LVLS_SOWER_OF_LIGHT}
                {ALL_UNITS_3LVLS_SOWER_OF_CHAOS}
                {ALL_UNITS_3LVLS_SOWER_OF_PEACE}
                {ALL_UNITS_4LVLS_SOWER_OF_ANCIENTS_KNOWLEDGE}
                {ALL_UNITS_4LVLS_SOWER_OF_GREED}
                {ALL_UNITS_4LVLS_SOWER_OF_DEATH}
                {ALL_UNITS_4LVLS_SOWER_OF_LIGHT}
                {ALL_UNITS_4LVLS_SOWER_OF_CHAOS}
                {ALL_UNITS_4LVLS_SOWER_OF_PEACE}
                {ALL_UNITS_5LVLS_SOWER_OF_ANCIENTS_KNOWLEDGE}
                {ALL_UNITS_5LVLS_SOWER_OF_GREED}
                {ALL_UNITS_5LVLS_SOWER_OF_DEATH}
                {ALL_UNITS_5LVLS_SOWER_OF_LIGHT}
                {ALL_UNITS_5LVLS_SOWER_OF_CHAOS}
                {ALL_UNITS_5LVLS_SOWER_OF_PEACE}
                
                {ALL_UNITS_01LVLS_NEUTRAL}
                {ALL_UNITS_2LVLS_NEUTRAL}
                {ALL_UNITS_3LVLS_NEUTRAL}
                {ALL_UNITS_4LVLS_NEUTRAL}
                {ALL_UNITS_5LVLS_NEUTRAL}
                {ALL_UNITS_01LVLS_LAWFUL}
                {ALL_UNITS_2LVLS_LAWFUL}
                {ALL_UNITS_3LVLS_LAWFUL}
                {ALL_UNITS_4LVLS_LAWFUL}
                {ALL_UNITS_5LVLS_LAWFUL}
                {ALL_UNITS_01LVLS_CHAOTIC}
                {ALL_UNITS_2LVLS_CHAOTIC}
                {ALL_UNITS_3LVLS_CHAOTIC}
                {ALL_UNITS_4LVLS_CHAOTIC}
                {ALL_UNITS_5LVLS_CHAOTIC}
        [/event]
        
                
        [event]
                name=side 1 turn 1
                first_time_only=yes
                {RANDOM_PORTRAIT}
                [message]
                        image=$RandomPortraitDefault
                        speaker=narrator
                        message= _ "Select a package from which units will be chosen:"
                        {ASKING_ABOUT_RANDOM_RECRUTS_PACKAGE "From all units" 0}
                        {ASKING_ABOUT_RANDOM_RECRUTS_PACKAGE "From one of the 6 fractions" 1}
                        {ASKING_ABOUT_RANDOM_RECRUTS_PACKAGE "By alignments" 2}
                [/message]
                [allow_undo]
                [/allow_undo]
                [set_variable]
                        name=RED
                        rand=1..255
                [/set_variable]
                [set_variable]
                        name=GREEN
                        rand=1..255
                [/set_variable]
                [set_variable]
                        name=BLUE
                        rand=1..255
                [/set_variable]
        [/event]
        
        [event]
                name=side 1 turn 1
                first_time_only=yes
                {RANDOM_PORTRAIT}
                [message]
                        image=$RandomPortraitDefault
                        speaker=narrator
                        message= _ "Choose number of randomly picked recruits:"
                        {ASKING_ABOUT_RANDOM_RECRUTS_NUMBER "Few - (4)" 4}
                        {ASKING_ABOUT_RANDOM_RECRUTS_NUMBER "Several - (6)" 6}
                        {ASKING_ABOUT_RANDOM_RECRUTS_NUMBER "More Than Several - (8)" 8}
                        {ASKING_ABOUT_RANDOM_RECRUTS_NUMBER "Normal Amount - (10)" 10}
                        {ASKING_ABOUT_RANDOM_RECRUTS_NUMBER "More Than Usual - (13)" 13}
                        {ASKING_ABOUT_RANDOM_RECRUTS_NUMBER "Many - (16)" 16}
                        {ASKING_ABOUT_RANDOM_RECRUTS_NUMBER "More Than Many - (20)" 20}
                        {ASKING_ABOUT_RANDOM_RECRUTS_NUMBER "The Enormity Of Units - (30)" 30}
                        {ASKING_ABOUT_RANDOM_RECRUTS_NUMBER "MORE MORE MORE of new units - (50)" 50}
                        {ASKING_ABOUT_RANDOM_RECRUTS_NUMBER "Just much as you can! - (80)" 80}
                [/message]
                [allow_undo]
                [/allow_undo]
                [switch]
                        variable=Pick_Option_WOTG
                        [case]
                                value=0
                                {RANDOM_RECRUITS_01LVLS_FROM_ALL_UNITS}
                        [/case]
                        [case]
                                value=1
                                {RANDOM_RECRUITS_01LVLS}
                        [/case]
                        [case]
                                value=2
                                {RANDOM_ALIGNMENTS_RECRUITS_01LVLS}
                        [/case]
                [/switch]
        [/event]

        {ADVANCE_SETUP_START}
        {KNOCKBACK_EVENT}

        [event]
                name=new turn
                {CHECK_PLAYERS 1}
                {CHECK_PLAYERS 2}
                {CHECK_PLAYERS 3}       
                {CHECK_PLAYERS 4}
                {CHECK_PLAYERS 5}
                {CHECK_PLAYERS 6}
                {CHECK_PLAYERS 7}
                {CHECK_PLAYERS 8}
                {CHECK_PLAYERS 9}
        [/event]
  {EOHS_EVENTS (<<EoHS.replace_leader_and_faction=true>>) (<<EoHS.init_campaign({ first_player_picks_settings=true })>>)}
[/era]
#endif

#endif

