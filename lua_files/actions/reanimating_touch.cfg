this_parses_in_both_wml_and_lua=hackily--{EOHS_LUA_FILE (<<-- reanimating_touch.cfg
-- #textdomain wesnoth-Era_of_High_Sorcery
local getmetatable,ipairs,next,pairs,setmetatable,tonumber,tostring,type,unpack = getmetatable,ipairs,next,pairs,setmetatable,tonumber,tostring,type,unpack
local wesnoth,table,string,math,os,debug,helper,_,EoHS,_G,_ENV = wesnoth,table,string,math,os,debug,EoHS.helper,EoHS._,EoHS,_G,nil

EoHS.make_touch_enchantment("reanimating_touch", {
  image = "attacks/touch-zombie.png",
  name = _"Reanimating Touch",
  description = _"You enchant your default melee attack. The next time you kill a unit on offense, you reanimate it on your side with (half plus 10) of its max hitpoints. If it wasn't undead before, it becomes an undead version of its unit type. While you hold a Reanimating Touch, you can also use it on your own or allies' units for 6 AP. (If you reanimate an ally's unit, your ally retains control of it.)",
  
  base_cost = { action_points=6, mana=7 },
  
  sound = "zombie-attack.wav",
})

EoHS.reanimating_touch_special = { "dummy", {
  id = "EoHS_reanimating_touch",
  name = _"reanimating touch",
  description = _"The next time this attack kills a unit on offense, that unit is reanimated with (half plus 10) of its max hitpoints. If it wasn't undead before, it becomes an undead version of its unit type."
}}

EoHS.make_unit_reanimated = function(unit, do_on_map)
  if do_on_map then
    
  end
  if unit.canrecruit then
    local side_recruits = wesnoth.sides[unit.side].recruit
    if side_recruits and (side_recruits ~= "") then
      unit.extra_recruit = (unit.extra_recruit and unit.extra_recruit.."," or "")..side_recruits
    end
  end
  EoHS.set_unit_variable(unit, "is_reanimated", true)
  EoHS.update_all_type_adjustments(unit)
  unit.attacks_left = 0
  unit.moves = 0
  unit.hitpoints = math.min(unit.max_hitpoints, math.floor(unit.max_hitpoints/2) + 10)
  if do_on_map then
    wesnoth.put_unit(unit)
    -- TODO wesnoth.fire("sound", {name="lich-hit-1.ogg"})
    wesnoth.float_label(unit.x, unit.y, "<span color='#000000'>"..(_"Reanimated!").."</span>")
    wesnoth.fire("redraw", { side=unit.side })
  end
end

-->>)}
