this_parses_in_both_wml_and_lua=hackily--{EOHS_LUA_FILE (<<-- _initial.cfg
-- #textdomain wesnoth-Era_of_High_Sorcery
local getmetatable,ipairs,next,pairs,setmetatable,tonumber,tostring,type,unpack,xpcall = getmetatable,ipairs,next,pairs,setmetatable,tonumber,tostring,type,unpack,xpcall
local wesnoth,table,string,math,os,debug,helper,_,EoHS,_G,_ENV = wesnoth,table,string,math,os,debug,EoHS.helper,EoHS._,EoHS,_G,nil

-- Some functions are frequently used even at preload time. We define them here so they can be used in any file.
-- We also provide EoHS.soon, which delays things just a little so that the function inside can use functions
-- defined in any other file.
EoHS.end_of_preload_funcs = {}
EoHS.soon = function(func)
  table.insert(EoHS.end_of_preload_funcs, func)
end

local pack = function(...) return {...} end
EoHS.capture_errors = function (func, ...)
  local traceback
  local arguments = pack (...)
  local results = pack(xpcall (function() return func(unpack (arguments)) end, function() traceback = debug.traceback() end))
  if results [1] then
    table.remove (results, 1)
    return unpack (results)
  else
    EoHS.err (results [2], traceback)
    return
  end
end

EoHS.events = {}
EoHS.event_functions = {}
EoHS.set_simple_event = function(name, unison, synchronized, force_empty_stack, func)
  table.insert(EoHS.event_functions, function ()
    EoHS.capture_errors (function()
      EoHS.begin_event(unison, synchronized, force_empty_stack)
      func()
      EoHS.end_event()
    end)
  end)
  table.insert(EoHS.events, {
    name = name,
    first_time_only = "no",
    { "lua", {
      code = [[--EoHS.set_simple_event("]]..name..[[", ...)
EoHS.event_functions[]]..#EoHS.event_functions..[[]()]]
    }},
  })
end

EoHS.filter_func = function(func)
  return function(...)
    local old_context = EoHS.context
    EoHS.context = {in_event=false, unison=false, synchronized=false, disunified_unit_tables={}}
    local results = pack(EoHS.capture_errors (func, ...))
    EoHS.context = old_context
    return unpack(results)
  end
end
EoHS.make_filter_func = function(name, func)
  _G[name] = EoHS.filter_func(func)
end

EoHS.deep_copy = function(input)
  if type(input) ~= "table" then return input end
  local tables = {}
  local function process_entry(entry)
    if type(entry) == "table" then
      if tables[entry] == nil then
        tables[entry] = {}
        for k,v in pairs(entry) do
          tables[entry][k] = process_entry(v)
        end
      end
      return tables[entry]
    else
      return entry
    end
  end
  return process_entry(input)
end

EoHS.universal_attack_specials = {}

EoHS.in_campaign = (
  wesnoth.game_config.campaign_type ~= "multiplayer" or
  (wesnoth.game_config.mp_settings and (
    (wesnoth.game_config.mp_settings.mp_campaign and wesnoth.game_config.mp_settings.mp_campaign ~= "")
    or string.match(wesnoth.game_config.mp_settings.mp_scenario_name, "World.Conquest")
  ))
)

-- Hack: multiplayer campaigns with no era count as being "era_default".
if EoHS.in_campaign and not
    (wesnoth.game_config.mp_settings and
     wesnoth.game_config.mp_settings.mp_era ~= "era_default") then
  EoHS.replace_alliances_with_era = nil
  EoHS.no_alliances = true
end

-->>)}
